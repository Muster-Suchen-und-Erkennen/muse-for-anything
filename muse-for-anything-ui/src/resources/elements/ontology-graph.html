<template data-maximized.bind="maximized & empty">
    <require from="./schema-form"></require>
    <require from="./validity-indicator"></require>
    <require from="./svg-icon.html"></require>
    <require from='./tree-node'></require>   

    <template id="ontologyGraphTemplate">
        <svg>
            <style>
                svg {
                    display: block;
                    width: 100%;
                    height: 100%;
                    border-radius: 0.375rem;
                    background-color: var(--fill-color);
                    --line-color: black;
                    --line-highlight-color: #6d28d9;
                    --text-color: black;
                    --text-highlight-color: #6d28d9;
                    --fill-color: white;
                    --fill-highlight-color: white;
                }

                svg .zoom-group {
                    will-change: contents, transform;
                }

                .ghost {
                    opacity: 0.5 !important;
                }

                .taxonomy-group {
                    fill: rgb(221, 221, 221) !important;
                }

                .type-group {
                    fill: rgb(189, 189, 189) !important;
                }

                .type-title-background {
                    fill: brown !important;
                    border-style: none;
                }

                .node>rect {
                    fill: var(--fill-color);
                    stroke: var(--line-color);
                }

                .taxonomy-link-item {
                    stroke-dasharray: 5px;
                }

                .type-link-item {
                    stroke-dasharray: 5px;
                }

                .link-handle {
                    display: none;
                    visibility:hidden;
                }

                .title {
                    fill: var(--text-color);
                    font-size: initial;
                    text-overflow: ellipsis;
                    word-break: break-all;
                    border-bottom: double;
                }

                .titleDescription {
                    fill: var(--text-color);
                    font-size: small;
                    text-overflow: ellipsis;
                    word-break: break-all;
                    border-bottom: double;

                }

                .type-title {
                    fill: var(--text-color);
                    font-size: initial;
                    text-overflow: ellipsis;
                    word-break: break-all;
                    border-bottom: double;
                }

                .description {
                    fill: var(--text-color);
                    font-size: 6pt;
                    text-overflow: ellipsis;
                }

                .sort-key {
                    fill: var(--text-color);
                    opacity: 0.8;
                    font-size: 6pt;
                    text-overflow: ellipsis;
                    text-anchor: end;
                }

                .node.hovered:not(.deleted) .link-handle {
                    display: initial;
                }

                .node.hovered>rect {
                    fill: var(--fill-highlight-color);
                    stroke: var(--line-highlight-color);
                }

                .node.selected>rect {
                    fill: var(--fill-highlight-color);
                    stroke: var(--line-highlight-color);
                }

                .node.selected .title {
                    fill: var(--text-highlight-color);
                }

                .node.deleted {
                    opacity: 0.5;
                }

                .edge {
                    stroke: var(--line-color);
                }

                .edge-group .marker {
                    fill: var(--line-color);
                }

                .highlight-outgoing .edge {
                    stroke: var(--line-highlight-color);
                }

                .highlight-outgoing.edge-group .marker {
                    fill: var(--line-highlight-color);
                }
            </style>
            <defs class="templates">
                <g id="taxonomy-item" data-template-type="node">
                    <rect width="120" height="60" x="-60" y="-30" rx="5" data-link-handles="edges"></rect>
                    <text class="titleDescription" x="-55" y="-13" width="110" data-content="typedescription"></text>
                    <text class="title" data-content="title" x="-55" y="4" width="110"></text>
                    <text class="description" data-content="description" x="-55" y="2"
                        data-wrap-lines="110 70|110 110 70"></text>
                    <text class="sort-key" data-content="sortKey" x="55" y="26" width="35"></text>
                </g>
                <g id="taxonomy-link-item" data-template-type="node">
                    <rect width="120" height="60" x="-60" y="-30" rx="5" data-link-handles="edges" class="taxonomy-link-item"></rect>
                    <text class="titleDescription" x="-55" y="-13" width="110" data-content="typedescription"></text>
                    <text class="title" data-content="title" x="-55" y="4" width="110"></text>
                    <text class="description" data-content="description" x="-55" y="2"
                        data-wrap-lines="110 70|110 110 70"></text>
                </g>
                <g id="type-link-item" data-template-type="node">
                    <rect width="120" height="60" x="-60" y="-30" rx="5" data-link-handles="edges" class="type-link-item"></rect>
                    <text class="titleDescription" x="-55" y="-13" width="110" data-content="typedescription"></text>
                    <text class="title" data-content="title" x="-55" y="4" width="110"></text>
                    <text class="description" data-content="description" x="-55" y="2"
                        data-wrap-lines="110 70|110 110 70"></text>
                </g>
                <g id="type-item" data-template-type="node">
                    <rect width="120" height="120" x="-60" y="-30" rx="5" data-link-handles="edges"></rect>
                    <rect class="type-title-background" x="-60" y="-30" height="20" width="120"></rect>
                    <text class="type-title" data-content="title" x="-55" y="-13" width="110"></text>
                    <text class="type-title" data-content="props" x="-55" y="-13" width="110"></text>
                    <text class="description" data-content="description" x="-55" y="2"
                        data-wrap-lines="110 70|110 110 70"></text>
                </g>
                <g id="default-marker" data-template-type="marker" data-line-attachement-point="6">
                    <circle cx="0" cy="0" r="6"></circle>
                </g>
                <g id="arrow" data-template-type="marker" data-line-attachement-point="-9 0">
                    <path d="M -9 -4 L 0 0 L -9 4 z" />
                </g>
            </defs>
            <g class="zoom-group"> <!-- the zoom-groop is used for the pan and zoom transormations -->
                <g class="nodes"></g> <!-- the first group will be rendered below the following groups-->
                <g class="edges"></g>
            </g>
        </svg>
    </template>


    <template id="ontologyoverviewGraphTemplate">
        <svg>
            <style>
                svg {
                    display: block;
                    width: 100%;
                    height: 100%;
                    border-radius: 0.375rem;
                    background-color: var(--fill-color);
                    --line-color: black;
                    --line-highlight-color: #6d28d9;
                    --text-color: black;
                    --text-highlight-color: #6d28d9;
                    --fill-color: rgba(255, 255, 255, 0);
                    --fill-highlight-color: rgba(255, 255, 255, 0);
                }

                svg .zoom-group {
                    will-change: contents, transform;
                }

                .ghost {
                    opacity: 0.5 !important;
                }

                .taxonomy-group {
                    fill: rgb(221, 221, 221) !important;
                }

                .type-group {
                    fill: rgb(189, 189, 189) !important;
                }

                .position-rect {
                    fill: #6c28d95d !important;
                    border-style: none !important;
                }

                .invisible-rect {
                    fill: #ffffff00 !important;
                    stroke: none !important;
                }

                .node>rect {
                    fill: none;
                    stroke: black;
                }

                .edge {
                    stroke: black;
                }

                .edge-group .marker {
                    fill: none
                }

                .highlight-outgoing .edge {
                    stroke: none
                }

                .highlight-outgoing.edge-group .marker {
                    fill: none
                }
            </style>
            <defs class="templates">
                <g id="taxonomy-item" data-template-type="node">
                    <rect width="120" height="60" x="-60" y="-30" rx="5" data-link-handles="edges"></rect>
                </g>
                <g id="type-item" data-template-type="node">
                    <rect width="120" height="120" x="-60" y="-30" rx="5" data-link-handles="edges"></rect>
                    <rect class="type-title-background" x="-60" y="-30" height="20" width="120"></rect>
                </g>
                <g id="default-marker" data-template-type="marker" data-line-attachement-point="6">
                    <circle cx="0" cy="0" r="6"></circle>
                </g>
                <g id="arrow" data-template-type="marker" data-line-attachement-point="-9 0">
                    <path d="M -9 -4 L 0 0 L -9 4 z" />
                </g>
            </defs>
            <g class="zoom-group"> <!-- the zoom-groop is used for the pan and zoom transormations -->
                <g class="nodes"></g> <!-- the first group will be rendered below the following groups-->
                <g class="edges"></g>
            </g>
        </svg>
    </template>

    <div if.bind=" !isAllowedToShowGraph">
        <h1 t="loading">Loading</h1>
    </div>
    <template else>
        <div class=" maindiv menu-section card">
            <div class="item-filtersection px-1 py-1 border-gray-200 border-b scroll-area">

                <span class="section-title">
                    ${"ontology.filter-area" | t}
                </span>
                <input class="border rounded-sm border-gray-800 focus:ring-4 w-full px-2 py-1" placeholder="search"
                    value.from-view="filter & throttle" aria-owns="'datalist-'+slug" autocapitalize="none"
                    value.bind="searchtext" type="text" autocomplete="off" aria-autocomplete="list" role="combobox"
                    id="'input-'+slug">
                <span class="section-title">
                    Visible elements
                </span>
                <div>
                    <label class="cb_control control--checkbox">
                        <input type="checkbox"  checked.bind="showTaxonomies">
                        <span class="control__indicator"></span>
                    </label>
                    Taxonomies
                </div>
                <div>
                    <label class="cb_control control--checkbox">
                        <input type="checkbox" checked.bind="showTypes">
                        <span class="control__indicator"></span>
                    </label>
                    Types
                </div>
                <div>
                    <span class="section-title">
                        Childs of types to show:
                    </span>
                    <input class="border rounded-sm border-gray-800 focus:ring-4 w-full px-2 py-1" placeholder="search"
                    value.from-view="filter & throttle" aria-owns="'datalist-'+slug" autocapitalize="none"
                    value.bind="typeChildsToShow" type="number" autocomplete="off" aria-autocomplete="list" role="combobox"
                    id="'input-'+slug">
                </div>
                <div>
                    Items in Graph ${graph.nodeList.length}
                </div>
            </div>
            <div class="item-treesection px-1 py-1 border-gray-200 border-b scroll-area" >

                <span class="section-title">
                    ${"ontology.tree-view" | t}
                </span>
                <tree-node repeat.for="node of dataItems" current.bind="node"></tree-node> 
            </div>
            <div class="item-overview">
                <network-graph class="graphoverview" classes="taxonomy-item deleted" mode="display" zoom="automatic"
                    svg-template="#ontologyoverviewGraphTemplate">
                </network-graph>
            </div>
        </div>
        <network-graph class="maingraph menu-graph ml-2 card"
            classes="taxonomy-item deleted" mode="layout" zoom="both" svg-template="#ontologyGraphTemplate">
        </network-graph>
        <div class="menu-graph ml-2 card" if.bind="isLoading!=2">
            <button class="button-outline px-2 items-center" click.delegate="renderGraph()">${"ontology.ShowGraph" | t}
            <!--                    </button>
            <spinner if.bind="isLoading!=0" type="S8" style-class="" size="100" color="default"></spinner>
            Loading: ${isLoading}-->
        </div>
        <div class="menu-graph mb-0 mt-auto ml-auto mr-0">
            <div if.bind="selectedNode != null" class="card bg-white px-3 py-2 items-center">
                detailinfo
                ${selectedNode.id}!
            </div>
            <div class="buttons card bg-white px-3 py-2 items-center" style="width: fit-content;float: right;">
                <button class="button-flat px-2 items-center" click.delegate="toggleMenu()"
                    title='${"ontology.moveLeft" | t}'>
                    <svg-icon icon.bind="maximizeMenu ? 'arrow-right' : 'arrow-left'" size.bind="18"></svg-icon>
                </button>
                <div if.bind="maximizeMenu">
                    <div class="ontology-moveBackground">
                        <div class="ontology-move">

                            <button class="button-flat px-2 items-center" click.delegate="moveGraph('up')"
                                title='${"ontology.moveUp" | t}'>
                                <svg-icon icon.bind="'arrow-up'" size.bind="18"></svg-icon>
                            </button>
                        </div>
                        <div class="ontology-move">
                            <button class="button-flat px-2 items-center" click.delegate="moveGraph('left')"
                                title='${"ontology.moveLeft" | t}'>
                                <svg-icon icon.bind="'arrow-left'" size.bind="18"></svg-icon>
                            </button>
                            <button class="button-flat px-2 items-center" click.delegate="moveGraph('right')"
                                title='${"ontology.moveRight" | t}'>
                                <svg-icon icon.bind="'arrow-right'" size.bind="18"></svg-icon>
                                
                            </button>

                        </div>
                        <div class="ontology-move">
                            <button class="button-flat px-2 items-center" click.delegate="moveGraph('down')"
                                title='${"ontology.moveDown" | t}'>
                                <svg-icon icon.bind="'arrow-down'" size.bind="18"></svg-icon>
                            </button>

                        </div>
                    </div>

                    <button class="button-flat px-2 items-center" click.delegate="zoomIn()"
                        title='${"ontology.zoomIn" | t}'>
                        <svg-icon icon.bind="'plus'" size.bind="18"></svg-icon>
                    </button>
                    <button class="button-flat px-2 items-center" click.delegate="zoomOut()"
                        title='${"ontology.zoomOut" | t}'>
                        <svg-icon icon.bind="'minus'" size.bind="18"></svg-icon>
                    </button>
                    <button class="button-flat px-2 items-center" click.delegate="resetLayout()"
                        title='${"ontology.resetLayout" | t}'>
                        <svg-icon icon.bind="'reset'" size.bind="18"></svg-icon>
                    </button>
                    <button class="button-flat px-2 items-center" click.delegate="toggleMaximize()"
                        title='${"ontology.toggleMaximize" | t}'>
                        <svg-icon icon.bind="maximized ? 'minimize' : 'maximize'" size.bind="18"></svg-icon>
                    </button>
                </div>
            </div>
        </div>
        
    </template>
</template>