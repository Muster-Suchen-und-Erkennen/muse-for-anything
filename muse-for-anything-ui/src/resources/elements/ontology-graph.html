<template data-maximized.bind="maximized & empty">
    <require from="./schema-form"></require>
    <require from="./validity-indicator"></require>
    <require from="./svg-icon.html"></require>

    <template id="taxonomyGraphTemplate">
        <svg>
            <style>
                svg {
                    display: block;
                    width: 100%;
                    height: 100%;
                    min-height: 60vh;
                    border-radius: 0.375rem;
                    background-color: var(--fill-color);
                    --line-color: black;
                    --line-highlight-color: #6d28d9;
                    --text-color: black;
                    --text-highlight-color: #6d28d9;
                    --fill-color: white;
                    --fill-highlight-color: white;
                }

                svg .zoom-group {
                    will-change: contents, transform;
                }

                .ghost {
                    opacity: 0.5 !important;
                }

                .taxonomy-group {
                    fill: rgb(221, 221, 221) !important;
                }

                .type-group {
                    fill: rgb(189, 189, 189) !important;
                }

                .type-title-background {
                    fill: brown !important;
                    border-style: none;
                }

                .node>rect {
                    fill: var(--fill-color);
                    stroke: var(--line-color);
                }

                .link-handle {
                    display: none;
                    fill: var(--line-color);
                    opacity: 0.1;
                }

                .link-handle>* {
                    transition: transform 0.25s ease-out;
                }

                .edge-group .link-handle {
                    display: initial
                }

                .link-handle:hover {
                    opacity: 0.7;
                }

                .link-handle:hover>* {
                    transform: scale(1.5);
                }

                .title {
                    fill: var(--text-color);
                    font-size: initial;
                    text-overflow: ellipsis;
                    word-break: break-all;
                    border-bottom: double;
                }

                .type-title {
                    fill: var(--text-color);
                    font-size: initial;
                    text-overflow: ellipsis;
                    word-break: break-all;
                    border-bottom: double;
                }

                .description {
                    fill: var(--text-color);
                    font-size: 6pt;
                    text-overflow: ellipsis;
                }

                .sort-key {
                    fill: var(--text-color);
                    opacity: 0.8;
                    font-size: 6pt;
                    text-overflow: ellipsis;
                    text-anchor: end;
                }

                .node.hovered:not(.deleted) .link-handle {
                    display: initial;
                }

                .node.hovered>rect {
                    fill: var(--fill-highlight-color);
                    stroke: var(--line-highlight-color);
                }

                .node.selected>rect {
                    fill: var(--fill-highlight-color);
                    stroke: var(--line-highlight-color);
                }

                .node.selected .title {
                    fill: var(--text-highlight-color);
                }

                .node.deleted {
                    opacity: 0.5;
                }

                .edge {
                    stroke: var(--line-color);
                }

                .edge-group .marker {
                    fill: var(--line-color);
                }

                .highlight-outgoing .edge {
                    stroke: var(--line-highlight-color);
                }

                .highlight-outgoing.edge-group .marker {
                    fill: var(--line-highlight-color);
                }
            </style>
            <defs class="templates">
                <g id="taxonomy-item" data-template-type="node">
                    <rect width="120" height="60" x="-60" y="-30" rx="5" data-link-handles="edges"></rect>
                    <text class="title" data-content="title" x="-55" y="-13" width="110"></text>
                    <text class="description" data-content="description" x="-55" y="2"
                        data-wrap-lines="110 70|110 110 70"></text>
                    <text class="sort-key" data-content="sortKey" x="55" y="26" width="35"></text>
                </g>
                <g id="type-item" data-template-type="node">
                    <rect width="120" height="120" x="-60" y="-30" rx="5" data-link-handles="edges"></rect>
                    <rect class="type-title-background" x="-60" y="-30" height="20" width="120"></rect>
                    <text class="type-title" data-content="title" x="-55" y="-13" width="110"></text>
                    <text class="type-title" data-content="props" x="-55" y="-13" width="110"></text>
                    <text class="description" data-content="description" x="-55" y="2"
                        data-wrap-lines="110 70|110 110 70"></text>
                    <text class="sort-key" data-content="sortKey" x="55" y="26" width="35"></text>
                </g>
                <g id="default-marker" data-template-type="marker" data-line-attachement-point="6">
                    <circle cx="0" cy="0" r="6"></circle>
                </g>
                <g id="arrow" data-template-type="marker" data-line-attachement-point="-9 0">
                    <path d="M -9 -4 L 0 0 L -9 4 z" />
                </g>
            </defs>
        </svg>
    </template>


    <template id="ontologyoverviewGraphTemplate">
        <svg>
            <style>
                svg {
                    display: block;
                    width: 100%;
                    height: 100%;
                    border-radius: 0.375rem;
                    background-color: var(--fill-color);
                    --line-color: black;
                    --line-highlight-color: #6d28d9;
                    --text-color: black;
                    --text-highlight-color: #6d28d9;
                    --fill-color: rgba(255, 255, 255, 0);
                    --fill-highlight-color: rgba(255, 255, 255, 0);
                }

                svg .zoom-group {
                    will-change: contents, transform;
                }

                .ghost {
                    opacity: 0.5;
                }

                .position-rect {
                    fill: #6c28d95d !important;
                    border-style: none;
                }

                .node>rect {
                    fill: var(--fill-color);
                }
            </style>
        </svg>
    </template>

    <div class="container bg-white">
        <div if.bind=" !isLoggedIn">
            <h1 t="loading">Loading</h1>
        </div>
        <template else>
            <div class="card maindiv">
                <div class="item-filtersection px-2 py-1 border-gray-200 border-b">
                    ${"ontology.filter-area" | t}
                    <input class="border rounded-sm border-gray-800 focus:ring-4 w-full px-2 py-1" placeholder="search"
                        value.from-view="filter & throttle" aria-owns="'datalist-'+slug" autocapitalize="none"
                        value.bind="searchtext" type="text" autocomplete="off" aria-autocomplete="list" role="combobox"
                        id="'input-'+slug">
                </div>
                <div class="item-treesection px-2 py-1 border-gray-200 border-b">
                    ${"ontology.tree-view" | t}
                    <!--<ul class="ml-5" style="list-style-type:circle">
                        <li repeat.for="node of graph.nodeList" if.bind="node.title.startsWith(searchtext)">
                            ${node.title}!
                        </li>
                    </ul>-->
                    <mdc-tree-view nodes.bind="graph.nodeList" view-model.ref="treeView">
                        <mdc-tree-node>${$node.title}
                        </mdc-tree-node>
                      </mdc-tree-view>
                </div>
                <div class="item-overview">
                    <network-graph class="graphoverview" classes="taxonomy-item deleted" mode="display" zoom="automatic"
                        svg-template="#ontologyoverviewGraphTemplate">
                    </network-graph>
                </div>
            </div>
            <network-graph class="maingraph item-main card ml-3 px-2 py-1 border-gray-200 border-l bg-white"
                classes="taxonomy-item deleted" mode="layout" zoom="both" svg-template="#taxonomyGraphTemplate">
            </network-graph>
            <div class="item-main mb-0 mt-auto ml-auto mr-0 ">
                <div if.bind="selectedNode != null" class="card bg-white px-3 py-2 items-center">
                    detailinfo
                    ${selectedNode.id}!
                </div>
                <div class="buttons card bg-white px-3 py-2 items-center" style="width: fit-content;float: right;">
                    <button class="button-flat px-2 items-center" click.delegate="toggleMenu()"
                        title='${"ontology.moveLeft" | t}'>
                        <svg-icon icon.bind="maximizeMenu ? 'arrow-right' : 'arrow-left'" size.bind="18"></svg-icon>
                    </button>
                    <div if.bind="maximizeMenu">
                        <div class="ontology-moveBackground">
                            <div class="ontology-move">
    
                                <button class="button-flat px-2 items-center" click.delegate="moveGraph('up')"
                                    title='${"ontology.moveUp" | t}'>
                                    <svg-icon icon.bind="'arrow-up'" size.bind="18"></svg-icon>
                                </button>
                            </div>
                            <div class="ontology-move">
                                <button class="button-flat px-2 items-center" click.delegate="moveGraph('left')"
                                    title='${"ontology.moveLeft" | t}'>
                                    <svg-icon icon.bind="'arrow-left'" size.bind="18"></svg-icon>
                                </button>
                                <button class="button-flat px-2 items-center" click.delegate="moveGraph('right')"
                                    title='${"ontology.moveRight" | t}'>
                                    <svg-icon icon.bind="'arrow-right'" size.bind="18"></svg-icon>
                                </button>
    
                            </div>
                            <div class="ontology-move">
                                <button class="button-flat px-2 items-center" click.delegate="moveGraph('down')"
                                    title='${"ontology.moveDown" | t}'>
                                    <svg-icon icon.bind="'arrow-down'" size.bind="18"></svg-icon>
                                </button>
    
                            </div>
                        </div>
    
                        <button class="button-flat px-2 items-center" click.delegate="zoomIn()"
                            title='${"ontology.zoomIn" | t}'>
                            <svg-icon icon.bind="'plus'" size.bind="18"></svg-icon>
                        </button>
                        <button class="button-flat px-2 items-center" click.delegate="zoomOut()"
                            title='${"ontology.zoomOut" | t}'>
                            <svg-icon icon.bind="'minus'" size.bind="18"></svg-icon>
                        </button>
                        <button class="button-flat px-2 items-center" click.delegate="resetLayout()"
                            title='${"ontology.resetLayout" | t}'>
                            <svg-icon icon.bind="'reset'" size.bind="18"></svg-icon>
                        </button>
                        <button class="button-flat px-2 items-center" click.delegate="toggleMaximize()"
                            title='${"ontology.toggleMaximize" | t}'>
                            <svg-icon icon.bind="maximized ? 'minimize' : 'maximize'" size.bind="18"></svg-icon>
                        </button>
                    </div>
                </div>
            </div>
            
        </template>
    </div>
</template>